@model Cfp
@{
    ViewData["Title"] = @Model.EventName + "CFP Details";

    var cfpUrl = string.IsNullOrWhiteSpace(Model.CfpUrl) ? Model.EventUrl : Model.CfpUrl;
}
<!-- CFP details-->
<div class="recipe-detail">
    <div class="container">
        <div class="row" style="margin-bottom: 15px;">
            <div class="col-lg-12">
                <div class="float-left">
                    <div class="addthis_inline_share_toolbox"></div>
                    <small id="shareButtons" class="form-text text-muted">Share this CFP</small>
                </div>
                <a href="@cfpUrl" class="btn btn-lg float-right" style="background-color: #DD3326;color: white;">Go to CFP <i class="fa fa-external-link"></i></a>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-12 text-center">
                <h4>@Model.EventName</h4>
                <h1>CFP Closes: @Model.CfpEndDate.ToString("MMM dd, yyyy")</h1>
                @if (!string.IsNullOrWhiteSpace(Model.SubmittedByName))
                {
                    <div class="by"><i class="fa fa-user" aria-hidden="true"></i> @Model.SubmittedByName</div>
                }
            </div>
            <div class="col-lg-8 text-center">
                <img src="@Model.EventImage" class="img-fluid" style="max-width: 100%; max-height: 300px;object-fit: cover;" alt="Event image">
                <div class="info">
                    <div class="row">
                        <div class="col-lg-4 col-sm-4">
                            <p>Event Location:</p>
                            <p>
                                <strong><i class="fa fa-map-marker" aria-hidden="true"></i> <a href="http://www.google.com/maps/place/@Model.EventLocationLat,@Model.EventLocationLng" target="_blank">@Model.EventLocationName</a></strong>
                            </p>
                        </div>
                        <div class="col-lg-4 col-sm-4">
                            <p>Event date(s):</p>
                            <p>
                                <strong>
                                    @if (@Model.EventStartDate != default(DateTime) && @Model.EventEndDate != default(DateTime))
                        {
                            @Html.Raw($"<i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i> {Model.EventStartDate.ToShortDateString()} - {@Model.EventEndDate.ToShortDateString()}");
                        }
                                    else if (@Model.EventStartDate == @Model.EventEndDate && @Model.EventStartDate != default(DateTime) && @Model.EventEndDate != default(DateTime))
                                    {
                                        @Html.Raw($"<i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i> {Model.EventStartDate.ToShortDateString()}");
                                    }
                                    else
                                    {
                                        if (!string.IsNullOrWhiteSpace(Model.EventUrl))
                                        {
                                            @Html.Raw($"<a href=\"{Model.EventUrl}\" target=\"_blank\">See website</a>");
                                        }
                                        else
                                        {
                                            @($"See website");
                                        }
                                    }
                            </strong>
                        </p>
                    </div>
                    <div class="col-lg-4 col-sm-4">
                        <p>Provides T&amp;E:</p>
                        <p>
                            <strong>@Model.ProvidedExpenses</strong>
                        </p>
                    </div>
                </div>
            </div>

            <p>@Model.EventDescription</p>
            <div class="tag">
                @*<a href="#">.NET</a>
                    <a href="#">Development</a>
                    <a href="#">Azure</a>*@
            </div>
            <div class="nutrition-facts clearfix">
            <h3>Good to know</h3>
                <div>
                    <p>CFP added:</p>
                    <p>
                        <strong>@Model.CfpAdded.ToShortDateString()</strong>
                    </p>
                </div>
                <div>
                    <p>Viewed:</p>
                    <p>
                        <strong>@Model.Views times</strong>
                    </p>
                </div>
            </div>
                
            <div class="blog-comment">
            <hr>

            <div class="alert alert-success" role="alert" id="issue-success" style="display: none;">
                Your issue was sent succesfully! If needed, we will get back to you shortly and/or correct the issue.<br />
                Thank you for your attention to detail!
            </div>

            <div class="alert alert-danger" role="alert" id="issue-error" style="display: none;">
                There was an error sending your issue. Please check all the fields carefully and try again.
            </div>
                
            <div class="reply" id="issue-form">
              <h3>Report issue</h3>
                <p class="comment-form-comment">
                  <textarea class="form-control" placeholder="For example: close date is wrong, URL is missing, etc." id="comment" name="comment" cols="45" rows="5" required="required" aria-required="true"></textarea>
                </p>
                <div class="row">
                  <div class="col-md-6">
                    <p class="comment-form-author">
                      <label for="author">Name <span class="required">*</span>
                      </label>
                      <input class="form-control" id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required="true" required="required">
                    </p>
                  </div>
                  <div class="col-md-6">
                    <p class="comment-form-email">
                      <label for="email">Email <span class="required">*</span>
                      </label>
                      <input class="form-control" id="email" name="email" type="text" value="" size="30" maxlength="100" aria-required="true" required="required">
                    </p>
                  </div>
                </div>
                <p class="form-submit">
                    <i class="fa fa-spinner fa-spin" id="sendIssueSpinner" style="font-size: 24px;display: none;"></i>
                    <input class="btn btn-submit btn-block" name="submit" type="submit" id="submit" value="Send issue" onclick="javascript:ReportIssue();">
                </p>
            </div>
          </div>
        </div>
    </div>
</div>
</div>
@section Scripts {
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ad705ab67da4ff7"></script>
    <script type="text/javascript" src="/js/custom.js"></script>

    <script type="text/javascript">
    var issue = {};
    issue.cfpId = '@Model.Id';
    issue.name = null;
    issue.emailAddress = null;
    issue.description = null;

    function ReportIssue()
    {
        $('#issue-error').hide();
        $('#submit').hide();
        $('#sendIssueSpinner').show();

        issue.name = $('#author').val();
        issue.emailAddress = $('#email').val();
        issue.description = $('#comment').val();

        //  TODO: check empty fields
        if (issue.name === '' || issue.emailAddress === '' || issue.description === '' || !validateEmail(issue.emailAddress))
        {
            $('#submit').show();
            $('#sendIssueSpinner').hide();
            $('#issue-error').show();
            return;
        }

        $.ajax({
            type: "POST",
            url: "/cfp/sendreportissue",
            data: {issue},
            success: function() {
                $('#issue-form').hide();
                $('#issue-success').show();
            },
            error: function() {
                // TODO: Show error message
                $('#submit').show();
                $('#sendIssueSpinner').hide();
                $('#issue-error').show();
            }
        });
    }
    </script>
}