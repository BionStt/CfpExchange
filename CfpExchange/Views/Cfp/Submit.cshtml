@{
    ViewData["Title"] = "Submit new CFP";
}

<!-- Submit CFP-->
  <div class="submit">
    <div class="title">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <h2>Submit CFP</h2>
            Please do not fill out this form! Check out the <a href="@(Url.Action("about", "home"))">About</a> page on how to contact me. <br /><br />
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">

            <div class="form-group">
              <label>Event URL</label>
              <input type="text" class="form-control" onblur="javascript: getMetadata(this.value);">
              <small id="eventUrlHelp" class="form-text text-muted">Enter the URL of the event homepage, we'll try to extract some information from there for you. No worries, you can still tweak it!</small>
            </div>

            <div class="form-group" id="eventUrlPreview" style="display:none;">
                <a id="eventUrl" class="fragment" href="#" target="_blank">
                    <img src ="https://placehold.it/116x116" alt="Event image"/> 
                    <h3>Event Title</h3>
                    <p class="text">
                        
                    </p>
                </a>
                <small id="eventUrlPreviewHelp" class="form-text text-muted"><a href="#">Edit this data manually</a></small>
            </div>

             <div class="form-group">
              <label>Event Title</label>
              <input type="text" class="form-control" id="eventTitle">
              <small id="eventTitleHelp" class="form-text text-muted">Under this title the CFP will be listed</small>
            </div>

            <div class="form-group">
              <label>CFP url</label>
              <input type="text" class="form-control" id="eventCfpDirectUrl">
              <small id="eventTitleHelp" class="form-text text-muted">Is there a direct link to the CFP portal? Please let us know here!</small>
            </div>

            <div class="form-group">
                <label>CFP Close Date</label>
                <input class="form-control col-lg-12" id="eventCfpCloseDate" type="text" readonly>
                <small id="eventCfpCloseDateHelp" class="form-text text-muted">When does the CFP close?</small>
            </div>

            <div class="form-group">
                <label>Event Location</label>
                <input class="form-control" id="eventLocation" type="text">
                <small id="eventLocationHelp" class="form-text text-muted">Where does the event take place?</small>
            </div>

            <div class="form-group">
                <label>Event Dates</label>
                <div class="form-row">
                    <div class="col">
                        <input class="form-control col-lg-12" id="eventStartDate" type="text" placeholder="Start date" readonly>
                    </div>
                    <div class="col">
                        <input class="form-control col-lg-12" id="eventEndDate" type="text" placeholder="End date" readonly>
                    </div>
                </div>
                <small id="eventDatesHelp" class="form-text text-muted">When does the event take place?</small>
            </div>

            <!--<div class="form-group">
              <label>Choose category</label>
              <select class="js-search-category form-control" name="category" data-placeholder="Choose Category">
                <option value="1">All</option>
                <option value="2">Breakfast</option>
                <option value="3">Lunch</option>
                <option value="4">Beverages</option>
                <option value="5">Appetizers</option>
                <option value="6">Soups</option>
                <option value="7">Salads</option>
                <option value="8">Beef</option>
                <option value="9">Poultry</option>
                <option value="10">Pork</option>
                <option value="11">Seafood</option>
                <option value="12">Vegetarian</option>
                <option value="13">Vegetables</option>
                <option value="14">Desserts</option>
                <option value="15">Canning / Freezing</option>
                <option value="16">Breads</option>
                <option value="17">Holidays</option>
              </select>
            </div>

            <div class="form-group">
              <label>Short summary</label>
              <textarea class="form-control" rows="4" required="required"></textarea>
            </div>

            <div class="form-group">
              <label>Tag</label>
              <input type="text" class="form-control">
            </div>

            <div class="form-group">
              <label>Upload your photos</label>
              <input type="file" class="form-control-file">
            </div>

            <div class="form-group">
              <label>Ingredients:</label>

              <div id="sortable">
                <div class="box ui-sortable-handle">
                  <div class="row">
                    <div class="col-lg-1 col-sm-1">
                      <i class="fa fa-arrows" aria-hidden="true"></i>
                    </div>
                    <div class="col-lg-5 col-sm-5">
                      <input type="text" class="form-control" placeholder="Name of ingredient">
                    </div>
                    <div class="col-lg-5 col-sm-5">
                      <input type="text" class="form-control" placeholder="Notes (quantity or additional info)">
                    </div>
                    <div class="col-lg-1 col-sm-1">
                      <i class="fa fa-times-circle-o minusbtn" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>

              </div>
              <a href="#" class="btn btn-light">Add new ingredient</a>

            </div>

            <div class="form-group">
              <label>Directions:</label>
              <textarea class="form-control" rows="4" required="required"></textarea>
            </div>

            <div class="form-group">
              <label>Additional Informations</label>
              <hr>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Yield</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Preparation Time</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Cooking Time</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>

            <div class="form-group">
              <label>Nutrition Facts</label>
              <hr>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Calories</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Total Carbohydrate</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Total Fat</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Protein</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Cholesterol</label>
              <div class="col-sm-10">
                <input type="text" class="form-control">
              </div>
            </div>-->

            <button type="submit" class="btn btn-submit" onclick="javascript:submitCfp();alert('I love your enthusiasm! Sorry, not working yet..');">Submit CFP</button>
          </div>
        </div>
      </div>
    </div>
  </div>

@section Scripts {
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCgVGJaXfyAu25OCrj3xu7RI0GQvzQY4p4&libraries=places"></script>
    <script src="/js/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>

    <script type="text/javascript">
        var cfpToSubmit = {};
    
        function submitCfp()
        {
            // TODO get all data when user did not follow form fields
    
            $.ajax({
                type: "POST",
                url: "/cfp/submit",
                data: {"submittedCfp":cfpToSubmit},

                success: function(result) {

                    
                }
            });
        }

        function getMetadata(url) {
            $.ajax({
                type: "POST",
                url: "/cfp/getMetadata",
                data: {"url":url},
                success: function(metadata) {

                    cfpToSubmit.eventUrl = metadata.url;
                    cfpToSubmit.eventImageUrl = metadata.imageUrl;
                    cfpToSubmit.eventTitle = metadata.title;
                    cfpToSubmit.eventDescription = metadata.description;
    
                    $('#eventUrlPreview #eventUrl').attr('href', metadata.url);

                    if (metadata.imageUrl === null || metadata.imageUrl === '')
                        $('#eventUrlPreview img').hide();
                    else
                    {
                        $('#eventUrlPreview img').show();
                        $('#eventUrlPreview img').attr('src', metadata.imageUrl);
                    }
    
                    $('#eventUrlPreview h3').text(metadata.title);
                    $('#eventUrlPreview p').html(metadata.description);

                    $('#eventTitle').attr('value', metadata.title);
                    $('#eventUrlPreview').show();
                }
            });
        }

        $(document).ready(function() {
            $('#eventStartDate').datepicker({
                startView: 1
            });

            $('#eventEndDate').datepicker({
                startView: 1
            })

            $('#eventCfpCloseDate').datepicker({
                startView: 1
            });

            var autocomplete = new google.maps.places.Autocomplete(document.getElementById('eventLocation'));

            autocomplete.addListener('place_changed', function() {
                  var place = autocomplete.getPlace();
                  if (!place.geometry) {
                    // User entered the name of a Place that was not suggested and
                    // pressed the Enter key, or the Place Details request failed.
                    window.alert("No details available for input: '" + place.name + "'");
                    return;
                  }

                // TODO do something useful with our info
                cfpToSubmit.Location = document.getElementById('eventLocation').value;
                cfpToSubmit.Lat = place.geometry.location.lat();
                cfpToSubmit.Long = place.geometry.location.lng();
             }); 
        });
    </script>
}

@section Styles {
    <link href="/css/plugins/bootstrap-datepicker/bootstrap-datepicker3.min.css" rel="stylesheet">
}